<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ECharts</title>
    <!-- å¼•å…¥ echarts.js -->
    <script src="echarts.min.js"></script>
	<script type="text/javascript" src="jquery-3.1.0.js"></script>
	
	<link rel="stylesheet" href="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css">  
	<script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
	<script src="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	
</head>
<body>
    <!-- ä¸ºEChartså‡†å¤‡ä¸€ä¸ªå…·å¤‡å¤§å°ï¼ˆå®½é«˜ï¼‰çš„Dom -->

	<label style="font-size:20px;width:600px;" >Hot Topic</label><br/> 
	<table class="table table-hover"> 
		<tbody id="topic_table"> 
	</table> 
    <div id="main" style="width: 600px;height:400px;margin: 0 auto;"></div>
	
	
	
	
    <script type="text/javascript">
        // åŸºäºå‡†å¤‡å¥½çš„domï¼Œåˆå§‹åŒ–echartså®ä¾‹
        var myChart = echarts.init(document.getElementById('main'));
		
/*
topic ä¸­åœ‹äººå£½ 
post_create_time: 2016-07-10 , title: 2628 ä¸­åœ‹äººå£½ , reply: 116
post_create_time: 2016-07-11 , title: ä¼°å€¼æ˜é¡¯åä½, è²·å…¥1è¬è‚¡ä¸­åœ‹äººå£½, ç›®æ¨™$20å…ƒ , reply: 41
post_create_time: 2016-07-15 , title: 2628 ä¸­äººå£½é¦–ç›®æ¨™å…ˆçœ‹22èšŠ , reply: 18
topic å¸Œæœ› 
post_create_time: 2016-07-20 , title: 510æº–å‚™èµ·é£› , reply: 30
post_create_time: 2016-07-21 , title: ã€Š æœ‰ç·£ç›¸èš ã€‹ ç´”äº¤æµè¨è«– 22 , reply: 2783
topic 1 
post_create_time: 2016-07-04 , title: æœŸæŒ‡æœŸæ¬Šç¬¬åå›ã€‚ã€‚ã€‚è¿”æ¨¸æ­¸çœŸï¼Œè²·ç›ˆå¯ŒåŸºé‡‘ï¼Œä¸Šæœ›27.5, 2016å¹´7æœˆ4æ—¥é å‘Š , reply: 769
post_create_time: 2016-07-06 , title: 8195 (8386) åšä¹œé‡ , reply: 610
post_create_time: 2016-07-06 , title: 261....ä¸€æ ¼è€…ï¼Œéƒ½å‡å””åˆ° , reply: 40
post_create_time: 2016-07-08 , title: 2016 æ©«è¡Œç„¡å¿Œâˆ¼âˆ¼âˆ¼âˆ¼âˆ¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ , reply: 1689
post_create_time: 2016-07-09 , title: â˜†æŠ€è¡“åœ–è¡¨ & æŒ‡æ¨™/å€‰ä½â˜… äº’å‹•åˆ†äº«å€  (3) , reply: 337
post_create_time: 2016-07-09 , title: ä¸­åœ‹éŠ€è¡Œ(3988)~~é‚„çœ‹ä»ŠæœğŸ€ , reply: 597
post_create_time: 2016-07-10 , title: 2628 ä¸­åœ‹äººå£½ , reply: 116
post_create_time: 2016-07-11 , title: ä¼°å€¼æ˜é¡¯åä½, è²·å…¥1è¬è‚¡ä¸­åœ‹äººå£½, ç›®æ¨™$20å…ƒ , reply: 41
post_create_time: 2016-07-13 , title: $180 è²·å…¥ ä¸€çƒ qq ç­‰ $200ã€‚ã€‚ã€‚ , reply: 50
post_create_time: 2016-07-15 , title: å¹³ä¿2318ç„¡å¾—è¼¸ , reply: 13
post_create_time: 2016-07-16 , title: åˆ¸å•†ç›®æ¨™åƒ¹2318ä¸­åœ‹å¹³å®‰ä¿éšªå†‡å¾—è±¬ï¼ï¼ï¼ï¼ï¼ï¼ , reply: 24
post_create_time: 2016-07-20 , title: 510æº–å‚™èµ·é£› , reply: 30
post_create_time: 2016-07-21 , title: å¤§ç”Ÿè¾²æ¥­é‡‘è(1103.HK) , reply: 4
post_create_time: 2016-07-24 , title: æˆ‘ä¿‚mc,æƒ³å’Œæœ‹å‹åˆ†äº«! , reply: 392
post_create_time: 2016-07-26 , title: *271* æ‰“æ°£æ”¯æŒå€ (66) , reply: 20
post_create_time: 2016-07-27 , title: 431å¾…çˆ†---ä¸‹éš»2012ï¼Œ204 , reply: 29
post_create_time: 2016-07-27 , title: è¶…æ­£æŠ•è³‡çµ„åˆä¹‹åä¸€ - ç´°æ°´é•·æµç¬‘åˆ°æœ€å¾Œ (é™„æˆå“¡å±•æœ›åŠ#3æ›´æ–°7æœˆçµå„æˆå“¡å¼·å¼±æƒ…æ³) , reply: 1745
post_create_time: 2016-07-29 , title: 1421å¹´é«˜ä½3.55,ä¸€æŠ˜å·¦å³å…¥äº†.äº¬èˆ‡æ„å¤–,ä¹Ÿæœ‰é»ç¥å¥‡èˆ‡é–‹å¿ƒ , reply: 123
post_create_time: 2016-07-30 , title: --------------------------å³æ—¥-08-16-æœŸæŒ‡-------------------------- , reply: 1692
post_create_time: 2016-08-01 , title: å¼·å…¥1288 , reply: 114
post_create_time: 2016-08-01 , title: 582é‡è²¨ä¸»å¸­åˆ†äº«å€ğŸ˜ç¬¬ä¸‰å¹• , reply: 470
topic æ’ 
post_create_time: 2016-07-07 , title: æœ€å¾Œæº«é¦¨æç¤º:æ˜å¤©æœ‰è²¨å¥½èµ° , reply: 41
post_create_time: 2016-07-09 , title: â˜†æŠ€è¡“åœ–è¡¨ & æŒ‡æ¨™/å€‰ä½â˜… äº’å‹•åˆ†äº«å€  (3) , reply: 337
post_create_time: 2016-07-10 , title: æº«é¦¨æç¤º:è½æ—¥æœ‰è²¨ä¸€å®šè¦é›¢å ´!! , reply: 15
topic ç‰›ç†Š 
post_create_time: 2016-07-07 , title: å‘³è©±å””æä½ ï¼Œ æ¶ç‰›éå¤œ , reply: 344
post_create_time: 2016-07-09 , title: â˜†æŠ€è¡“åœ–è¡¨ & æŒ‡æ¨™/å€‰ä½â˜… äº’å‹•åˆ†äº«å€  (3) , reply: 337
post_create_time: 2016-07-15 , title: ç†Šå¸‚æœªå®Œ , reply: 421
post_create_time: 2016-07-20 , title: æˆ‘ä¿‚æ–°æ‰‹â€¦â€¦æœ€è¿‘ç‡å ±ç´™è©±çˆ†ä¸Š2è¬5ï¼Œæˆ‘æœ‰ä¸€ç­†300è¬è³‡ç”¢ , reply: 44
post_create_time: 2016-07-31 , title: ç‰›ç†Šå°é®®è‚‰å³å¸‚ç‰›ç†ŠæŒ‡å¼•ï¼ˆäº”ï¼‰ , reply: 3001

*/
		

//content_data[k]='<p>'+v+'</p>'

		// draw table
		function setTable(tableData){
		var trLineNumber=tableData.length;
		var _table = document.getElementById("topic_table"); 
		var _row; 
		var _cell; 
		for (var i = 0; i < trLineNumber; i++) { 
			_row = document.createElement("tr"); 
			var td_topic=tableData[i].topic;
			var td_data=tableData[i].data;
			_row.onclick= function(){myChart.setOption(setOption(this))}; //ä¸ºæ¯è¡Œå¢åŠ å•å‡»äº‹ä»¶ 
			_cell = document.createElement("td");
			_cell.innerText = td_topic; 
			_row.appendChild(_cell); 
			document.getElementById("topic_table").appendChild(_row); 

		} 
	} 


		//read file and get json data
		$.get('dbData.json',function(data){
			console.log('readfile');
			topic_obj = eval('(' + data + ')');
			console.log(topic_obj[0].data[0].date)
			setTable(topic_obj)
			
			/*
			$.each(json,function(i,value){
				var topic=this['topic']
				var data=this['data']
			});
			*/
		});

		var start='2016-07-01';
		var end='2016-08-01';
		var topic_obj;
		
		var oneDay = 24 * 3600 * 1000;
		var start_date = Date.parse(start);
		var end_date= Date.parse(end);
		var dates=(end_date-start_date)/oneDay;
		var date=[];

		
		for (var i = 0; i <= dates; i++) {
			var now = new Date(start_date+ i*oneDay);
			var str_date=[now.getFullYear(), now.getMonth()+1 , now.getDate()].join('-');
			date.push(str_date);
		};
/*
		 var content_data=[
			{'date':'2016-7-10','content': ['2628 ä¸­åœ‹äººå£½'],'reply':116},
			{'date':'2016-7-11','content': ['ä¼°å€¼æ˜é¡¯åä½, è²·å…¥1è¬è‚¡ä¸­åœ‹äººå£½, ç›®æ¨™$20å…ƒ'],'reply':41},
			{'date':'2016-7-15','content': ['2628 ä¸­äººå£½é¦–ç›®æ¨™å…ˆçœ‹22èšŠ'],'reply':18}
		];
		
*/



		function setOption(obj){
			var data_index=obj.rowIndex;
			var topic_json=topic_obj[data_index];
			var topic= topic_json.topic;
			var content_data=topic_json.data;
			var data=[];
			var value=[];
			for (var i =0,j=0, len_date=date.length,len_content_data=content_data.length; i<len_date; i++){
				//console.log(date[i])
				data[i]='';
				value[i]='';
				for( ;j<len_content_data;){
					//console.log(content_data[j].date)
					if (date[i]==content_data[j].date){
						console.log(date[i])
						data[i]=content_data[j].content;
						value[i]=content_data[j].reply;
						j++
						break;
					}else{
						break;
					}
				}
			}
			
			
			option = {
				title:{
					text:topic
					},
				color: ['#3398DB'],
				tooltip : {
					trigger: 'axis',
					axisPointer : {            // åæ ‡è½´æŒ‡ç¤ºå™¨ï¼Œåæ ‡è½´è§¦å‘æœ‰æ•ˆ
						type : 'shadow'        // é»˜è®¤ä¸ºç›´çº¿ï¼Œå¯é€‰ä¸ºï¼š'line' | 'shadow'
					},
					formatter:function(params, ticket, callback){
						// $.get('detail?name=' + params.name, function (content) {
						//    callback(ticket, toHTML(content));
						//});
						html_content=''
						if(params[0].value){
							content=data[params[0].dataIndex]
							html_content='<p>'+params[0].value+' times'+'</p>'
							for (var i =0,len_cotent=content.length;i<len_cotent;i++){
								html_content+='<p>'+content[i]+'</p>'
							}
						}
						 return html_content;

					}
				},
				grid: {
					left: '3%',
					right: '4%',
					bottom: '3%',
					containLabel: true
				},
				xAxis : [
					{
						type : 'category',
						data :date
			,
						axisTick: {
							alignWithLabel: true
						}
					}
				],
				yAxis : [
					{
						type : 'value'
					}
				],
				series : [
					{
						title:topic,
						name:'ç›´æ¥è®¿é—®',
						type:'bar',
						barWidth: '60%',
						data:value
					}
				]
			};
			return option;
		}



        // ä½¿ç”¨åˆšæŒ‡å®šçš„é…ç½®é¡¹å’Œæ•°æ®æ˜¾ç¤ºå›¾è¡¨ã€‚
        //myChart.setOption(option);
    </script>


</body>

</html> 	